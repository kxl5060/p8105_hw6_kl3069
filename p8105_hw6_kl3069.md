P8105 Homework 6
================
Kyung Suk Lee
2020-12-07

  - [Problem 1](#problem-1)

## Problem 1

``` r
homicide_df = 
  read_csv("./data/homicide-data.csv", na = c("", "NA", "Unknown")) %>%
  janitor::clean_names() %>% 
  mutate(
    city_state = str_c(city, state, sep = ", "),
    victim_age = as.numeric(victim_age),
    resolution = case_when(
      disposition == "Closed without arrest" ~ 0,
      disposition == "Open/No arrest"        ~ 0,
      disposition == "Closed by arrest"      ~ 1
  )) %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")),
         victim_race %in% c("White", "Black")) %>% 
  select(city_state, resolution, victim_age, victim_race, victim_sex)
```

``` r
baltimore_df = 
  homicide_df %>% 
  filter(city_state == "Baltimore, MD")

glm(resolution ~ victim_age + victim_race + victim_sex,
    data = baltimore_df, family = binomial()) %>% 
  broom::tidy() %>% 
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96*std.error),
    CI_upper = exp(estimate + 1.96*std.error)
  ) %>% 
  select(term, OR, starts_with("CI")) %>% 
  knitr::kable(digits = 3,
               format = "html",
               caption = "Table: Estimate and confidence interval of the adjusted odds ratio")
```

<table>

<caption>

Table: Estimate and confidence interval of the adjusted odds ratio

</caption>

<thead>

<tr>

<th style="text-align:left;">

term

</th>

<th style="text-align:right;">

OR

</th>

<th style="text-align:right;">

CI\_lower

</th>

<th style="text-align:right;">

CI\_upper

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:left;">

(Intercept)

</td>

<td style="text-align:right;">

1.363

</td>

<td style="text-align:right;">

0.975

</td>

<td style="text-align:right;">

1.907

</td>

</tr>

<tr>

<td style="text-align:left;">

victim\_age

</td>

<td style="text-align:right;">

0.993

</td>

<td style="text-align:right;">

0.987

</td>

<td style="text-align:right;">

1.000

</td>

</tr>

<tr>

<td style="text-align:left;">

victim\_raceWhite

</td>

<td style="text-align:right;">

2.320

</td>

<td style="text-align:right;">

1.648

</td>

<td style="text-align:right;">

3.268

</td>

</tr>

<tr>

<td style="text-align:left;">

victim\_sexMale

</td>

<td style="text-align:right;">

0.426

</td>

<td style="text-align:right;">

0.325

</td>

<td style="text-align:right;">

0.558

</td>

</tr>

</tbody>

</table>

``` r
models_results_df = 
  homicide_df %>% 
    nest(data = -city_state) %>% 
    mutate(
      models = map(.x = data, ~glm(resolution ~ victim_age + victim_race + victim_sex,
                                   data = .x,
                                   family = binomial())),
      results = map(models, broom::tidy)
    ) %>% 
    select(city_state, results) %>% 
    unnest(results) %>% 
    mutate(
      OR = exp(estimate),
      CI_lower = exp(estimate - 1.96*std.error),
      CI_upper = exp(estimate + 1.96*std.error)
    ) %>% 
    select(city_state, term, OR, starts_with("CI"))
```

``` r
models_results_df %>% 
  filter(term == "victim_raceWhite") %>% 
  mutate(city_state = fct_reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, y = OR, color = city_state))+
  geom_point()+
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper))+
  theme(axis.text.y = element_text(size = 6), legend.position = "none") +
  labs(
    title = "Odds Ratio by Cities",
    x = "City",
    y = "Odds Ratio",
    caption = "Datasource: The Washington Post",
    color = "") +
  theme(plot.title = element_text(face="bold",
                                  hjust=0.5,
                                  lineheight=1.2)) +
  scale_y_continuous(breaks = seq(0, 30, by = 1)) +
  coord_flip()
```

<img src="p8105_hw6_kl3069_files/figure-gfm/unnamed-chunk-4-1.png" width="100%" />

  - **Comment on the plot**: The above plot illustrates that for most
    cities the estimates for odds ratio are above 1.0. Such result
    indicates that more homicides are likely to be solved for white
    compared to non-whites. We can observe that this is more apparent in
    cities such as Boston, Omaha, Oakland, and Pittsburgh.
